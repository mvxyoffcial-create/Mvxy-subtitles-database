<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mvxy Subtitle Admin Panel</title>
<style>
body {
  background:#0b1220;
  color:white;
  font-family:Arial;
  padding:20px;
}
h2 {
  color:#00bfff;
  text-align:center;
}
.section {
  background:#111827;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
label {
  font-size:14px;
  margin-top:5px;
  display:block;
}
input, select, button {
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:6px;
  border:none;
}
button {
  background:#00bfff;
  color:white;
  cursor:pointer;
}
#status {
  margin-top:10px;
  font-size:14px;
}
</style>
</head>
<body>

<h2>üé¨ Mvxy Subtitle Admin Panel</h2>

<div class="section">
  <label>GitHub Token (Admin Only)</label>
  <input type="password" id="token" placeholder="Paste GitHub Token">
</div>

<div class="section">
  <h3>üé¨ Movies</h3>
  <label>Movie Name (example: Smurfs 2025)</label>
  <input type="text" id="movieName" placeholder="Smurfs 2025">

  <label>Movie Folder (example: smurfs-2025)</label>
  <input type="text" id="movieFolder" placeholder="smurfs-2025">

  <label>Language</label>
  <select id="movieLang">
    <option value="English">English</option>
    <option value="Sinhala">Sinhala</option>
  </select>

  <label>Subtitle File (.srt or .vtt only)</label>
  <input type="file" id="movieFile" accept=".srt,.vtt">

  <button onclick="uploadMovie()">Upload Movie Subtitle</button>
</div>

<div class="section">
  <h3>üì∫ TV Series</h3>
  <label>Series Name (example: Game of Thrones S01E01)</label>
  <input type="text" id="tvName" placeholder="Game of Thrones S01E01">

  <label>Series Folder (example: got/s01/e01)</label>
  <input type="text" id="tvFolder" placeholder="got/s01/e01">

  <label>Language</label>
  <select id="tvLang">
    <option value="English">English</option>
    <option value="Sinhala">Sinhala</option>
  </select>

  <label>Subtitle File (.srt or .vtt only)</label>
  <input type="file" id="tvFile" accept=".srt,.vtt">

  <button onclick="uploadTV()">Upload TV Subtitle</button>
</div>

<div id="status"></div>

<script>
const username = "mvxyoffcial-create";
const repo = "Mvxy-subtitles-database";

async function uploadFile(path, file) {
  const token = document.getElementById("token").value.trim();
  const status = document.getElementById("status");

  if (!token) {
    status.innerHTML = "‚ùå Please enter GitHub token!";
    return;
  }

  const ext = file.name.split(".").pop().toLowerCase();
  if (!["srt","vtt"].includes(ext)) {
    status.innerHTML = "‚ùå Only .srt or .vtt files allowed!";
    return;
  }

  const reader = new FileReader();
  reader.onload = async function() {
    const base64 = reader.result.split(",")[1];
    const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;

    const res = await fetch(url, {
      method: "PUT",
      headers: {
        "Authorization": "token " + token,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "Upload subtitle",
        content: base64
      })
    });

    const data = await res.json();

    if (res.ok) {
      const fileUrl = `https://${username}.github.io/${repo}/${path}`;
      status.innerHTML = `‚úÖ Uploaded successfully!<br>
      üìÅ Path: ${path}<br>
      üîó <a href="${fileUrl}" target="_blank">${fileUrl}</a>`;
    } else {
      status.innerHTML = "‚ùå Error: " + data.message;
    }
  };

  reader.readAsDataURL(file);
}

function uploadMovie() {
  const name = document.getElementById("movieName").value.trim();
  const folder = document.getElementById("movieFolder").value.trim();
  const lang = document.getElementById("movieLang").value;
  const file = document.getElementById("movieFile").files[0];

  if (!name || !folder || !file) {
    document.getElementById("status").innerHTML = "‚ùå Fill movie details!";
    return;
  }

  const ext = file.name.split(".").pop().toLowerCase();
  const path = `movies/${folder}/${lang === "English" ? "en" : "si"}.${ext}`;
  uploadFile(path, file);
}

function uploadTV() {
  const name = document.getElementById("tvName").value.trim();
  const folder = document.getElementById("tvFolder").value.trim();
  const lang = document.getElementById("tvLang").value;
  const file = document.getElementById("tvFile").files[0];

  if (!name || !folder || !file) {
    document.getElementById("status").innerHTML = "‚ùå Fill TV details!";
    return;
  }

  const ext = file.name.split(".").pop().toLowerCase();
  const path = `tv/${folder}/${lang === "English" ? "en" : "si"}.${ext}`;
  uploadFile(path, file);
}
</script>

</body>
</html>
